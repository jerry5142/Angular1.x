<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="lib/d3.min.js"></script>
<script src="lib/crossfilter.min.js"> </script>

<style>
.chart {
   border: solid 1px;
   border-color: gray;
   margin: 30px;
}

.chart .chartTitle {
   font: 18px sans-serif;
   fill: gray;
}

.chart rect {
   fill: black;
   opacity: 1;   
}

.chart rect:hover {
   fill: gray;
}

.chart text {
   font: 14px sans-serif;
   fill: gray;
   text-anchor: end;
}

.axis {
   fill: none;
}

.axis text {
   fill: light-gray;
   stroke: light-gray;
   stroke-width: 0.25;
}

.chart line {
   stroke: gray;
   stroke-width: 1;
   stroke-opacity:0.3;
}

</style>
</head>
<body>
<svg id="colors"></svg>
<svg id="alphabet"></svg>
<script>
//===========Configuration=============
//color chart
drawBarChart("Colors", "colors", 500, 300, 60, 20, 30, 60, 50, "data/dataCat.json", "category1");
//alpha chart
drawBarChart("Alphabet", "alphabet", 500, 300, 60, 20, 30, 60, 50, "data/dataCat.json", "category2");

//draws a bar chart
function drawBarChart(title, chartId, chartWidth, chartHeight, marginTop, marginRight, marginBottom, marginLeft, xAxisTicIncr, dataFilePath, category){
   //create an svg window and append a g element to it
   var chart = d3.select("#" + chartId).attr("width", chartWidth).attr("height", chartHeight),
       margin = {top: marginTop, right: marginRight, bottom: marginBottom, left: marginLeft},
       width = +chart.attr("width") - margin.left - margin.right,
       height = +chart.attr("height") - margin.top - margin.bottom,
       g = chart.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        
   var barHeight = height / 6;

   //set the axis scales
   var x = d3.scale.linear()
       .range([0, width]);

   //set the class for the chart 
   chart.attr("class", "chart");

   //get the data and graph it      
   d3.json(dataFilePath, function(data) {
      //create dimension, group by color, sum by value, and sort by grouped value
      var colorRecords = crossfilter(data.data)
         .dimension(function(fact){ return fact[category]; })
         .group()
         .reduceSum(function(d){ return d.value; })
         .all()
         .sort(function(x, y){ return d3.ascending(x.value, y.value); });
      
      var maxXtic = d3.max(colorRecords, function(d) { return d.value; });
      if(maxXtic % xAxisTicIncr){ // make max axis tic round up to next xAxisTicIncr
         maxXtic = maxXtic - (maxXtic % xAxisTicIncr) + xAxisTicIncr;
      }
      var xTicCount = maxXtic / xAxisTicIncr;  
      x.domain([0, maxXtic]);
      
      var barSection = (height / colorRecords.length);
      var barTop = (barSection - barHeight) / 2 ;

      var yAxisLabels = d3.extent(colorRecords, function(d) { return d.key; });
      
      var bar = g.selectAll("g")
      .data(colorRecords)
      .enter().append("g")
        .attr("transform", function(d, i) { return "translate(0," + Math.round( i * barSection + barTop) + ")"; });
        
      bar.append("text")
         .attr("class", "chart")
         .attr("x", -10)
         .attr("y", barTop - 5)
         .attr("dy", "0.71em")
         .attr("text-anchor", "end")
         .text(function(d){ return d.key; }); 
     
      //create the x-axis and move it to the bottom of the graph
      g.append("g")
         .attr("transform", "translate(0," + height + ")")
         .call(d3.svg.axis().scale(x).orient("bottom").ticks(xTicCount).innerTickSize(-height))
         .attr("class", "axis");      
     
      bar.append("rect")
        .attr("width", function(d) { return x(d.value); })
        .attr("height", barHeight - 1);;

      //add a title
      g.append("g")
        .append("text")
         .attr("class", "chartTitle")     
         .attr("x", width / 2)             
         .attr("y", -margin.top / 2)
         .text(title);
   });
};
</script>
</body>
</html>




