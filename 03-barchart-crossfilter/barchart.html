<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="lib/d3.min.js"></script>
<script src="lib/crossfilter.min.js"> </script>

<style>
.chart {
   font: 12px sans-serif;  
   fill: gray;
   border: solid 1px;
   border-color: gray;
}

.chart rect {
   fill: black;
}

.chart text {
   font-size: 18px;
   text-anchor: end;
}

.axisBar {
   fill: none;
   stroke: gray;
   stroke-width: 1.5;
}

.axisBar text {
   font: 12px sans-serif;  
   fill: black;
   stroke: gray;
   stroke-width: 0.5;
}

</style>
</head>
<body>
<svg id="colors"></svg>
<script>
//create an svg window and append a g element to it
//var chart = d3.select("#colors").append("svg").attr("width", 420).attr("height", 300),
var chart = d3.select("#colors").attr("width", 600).attr("height", 350),
    margin = {top: 20, right: 20, bottom: 30, left: 50},
    width = +chart.attr("width") - margin.left - margin.right,
    height = +chart.attr("height") - margin.top - margin.bottom,
    g = chart.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var xAxisTicIncr = 50;     
var barHeight = height / 6;

//set the axis scales
var x = d3.scale.linear()
    .range([0, width]);
var y = d3.scale.linear()
    .rangeRound([height, 0]);

 //set the class for the chart 
chart.attr("class", "chart");

//add a title
g.append("text")
   .attr("x", (width / 2))             
   .attr("y", 0)
   .text("Colors");
      
d3.json("data/dataCat.json", function(data) {
	//create dimensions
	var cf = crossfilter(data.data);
	var colorDim = cf.dimension(function(d){ return d.category1; });
	//sum the values for each color
	var colorGroupCounts = colorDim.group().reduceSum(function(fact){ return fact.value; });
	var colorGroupSize = colorGroupCounts.size();
	var colorRecords = colorGroupCounts.all();   
  
   var maxXtic = d3.max(colorRecords, function(d) { return d.value; });
   if(maxXtic % xAxisTicIncr){ // make max axis tic round up to next xAxisTicIncr
      maxXtic = maxXtic - (maxXtic % xAxisTicIncr) + xAxisTicIncr;
   }
   var xTicCount = maxXtic / xAxisTicIncr;
   
   x.domain([0, maxXtic]);
 
   var barSection = (height / colorGroupSize);
   var barTop = (barSection - barHeight) / 2 ;

   var bar = g.selectAll("g")
   .data(colorRecords)
   .enter().append("g")
     .attr("transform", function(d, i) { return "translate(0," + Math.round( i * barSection + barTop) + ")"; });

   bar.append("rect")
     .attr("width", function(d) { return x(d.value); })
     .attr("height", barHeight - 1);

   bar.append("text")
     .attr("x", function(d) { return x(d.value) - 3; })
     .attr("y", barHeight / 2)
     .attr("dy", ".35em")
  
   //create the x-axis and move it to the bottom of the graph
   g.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.svg.axis().scale(x).orient("bottom").ticks(xTicCount))
      .attr("class", "axisBar");

   //create the y-axis and move it to the left (vertical)
   g.append("g")
      .call(d3.svg.axis().scale(y).orient("left"))
      .attr("class", "axisBar");
});

</script>

</body>
</html>




